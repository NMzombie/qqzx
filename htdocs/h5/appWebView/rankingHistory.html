<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <title>历史排行</title>
  <link rel="stylesheet" href="ranking-history.css">
  <script>
    fnResize()
    window.onresize = function () {
      fnResize()
    }
    function fnResize () {
      var deviceWidth = document.documentElement.clientWidth || window.innerWidth
      if (deviceWidth >= 750) {
        deviceWidth = 750
      }
      if (deviceWidth <= 320) {
        deviceWidth = 320
      }
      document.documentElement.style.fontSize = (deviceWidth / 7.5) + 'px'
    }
  </script>
</head>
<body>
<div class="item-list"></div>
<script src="../js/jquery-1.10.2.js"></script>
<script src="../js/util.js"></script>
<script src="../js/moment.min.js"></script>
<script type="text/javascript">
  let baseUrl = ''
  getQueryString('dev') ? baseUrl = 'http://dev.wegoomall.cn' : baseUrl = 'http://api.wchoosemall.com'
  getUserInfo()
  function getUserInfo (){
    if (window.WebViewJavascriptBridge) {
      window.WebViewJavascriptBridge.callHandler('getUserInfo', {}, function (response) {
        const token = JSON.parse(response).token
        const level = JSON.parse(response).level
        $.ajax({
          type: 'post',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          url: `${baseUrl}/doc/api/common/auth/memberSales/getHistoryItemSales.json?token=${token}`,
          success: (res) => {
            const data = res.data
            let fir = ''
            for (let i = 0; i < data.list.length; i++) {
              fir += `<div class="item"><div class="info clearfix"><img src="${data.list[i].itemRankDTO.picUrls[0]}_400w.jpg" alt="" /><div class="detail"><div class="title one-txt-cut">${data.list[i].itemRankDTO.name}</div><div class="price clearfix"><div class="member">¥${level >= 10 ? priceFormat(data.list[i].itemRankDTO.memberPrice) : priceFormat(data.list[i].itemRankDTO.marketPrice)}</div><div class="market">市场价¥${level >= 10 ? priceFormat(data.list[i].itemRankDTO.marketPrice) : priceFormat(data.list[i].itemRankDTO.showPrice)}</div></div></div></div><div class="date clearfix"><div class="limit">活动时间：${moment(data.list[i].itemRankDTO.startDate).format('YYYY-MM-DD')}至${moment(data.list[i].itemRankDTO.endDate).format('YYYY-MM-DD')}</div><a href="javascript:void(0)" onclick="seeMore(${data.list[i].itemRankDTO.activityId})"><div class="more">查看排行＞</div></a></div></div>`
            }
            $('.item-list').append(fir)
          }
        })
      })
    } else {
      setTimeout(() => {
        getUserInfo()
      }, 50)
    }
  }
  function seeMore (id) {
    window.location.href = `./rankingHistoryDetail.html?activityId=${id}`
  }
</script>
</body>
</html>
